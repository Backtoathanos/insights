import"https://checkout.razorpay.com/v1/checkout.js";import"./BaseLayout.astro_astro_type_script_index_0_lang.Ew17R0gt.js";import"https://code.jquery.com/jquery-3.6.0.min.js";import"./MobileNavDropdown.astro_astro_type_script_index_0_lang.CV5_KfF_.js";import"./_commonjsHelpers.BosuxZz1.js";document.addEventListener("DOMContentLoaded",()=>{const t=JSON.parse(sessionStorage.getItem("checkoutData"));if(!t){window.location.href="/new-projects-near-me/subscribe";return}document.getElementById("industry-title").textContent=t.industryTitle,document.getElementById("license-name").textContent=t.licenseName,document.getElementById("base-plan-label").textContent=`Base Plan (${t.licenseName})`;const p=d(t.basePrice,t.currency);document.getElementById("base-plan-price").textContent=`${c(t.currency)}${p}`;const u=document.getElementById("addons-list"),y=document.getElementById("price-breakdown");t.addons.forEach(e=>{const n=document.createElement("li");n.className="flex items-start",n.innerHTML=`
          <svg class="mr-2 mt-0.5 h-4 w-4 flex-shrink-0 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
          </svg>
          <span>${e.title} - ${c(t.currency)}${d(e.price,t.currency)}</span>
        `,u.appendChild(n);const r=document.createElement("div");r.className="flex justify-between text-sm",r.innerHTML=`
          <span class="text-gray-500 dark:text-gray-400">${e.title}</span>
          <span class="text-gray-900 dark:text-white">${c(t.currency)}${d(e.price,t.currency)}</span>
        `,y.appendChild(r)});const l=d(t.total,t.currency);document.getElementById("total-price").textContent=`${c(t.currency)}${l}`,document.getElementById("payment-button-text").textContent=`Proceed to Payment (${c(t.currency)}${l})`;const i=Math.round(t.total*100);var o={key:"rzp_test_tG1GUeJhSbGd0d",amount:i,currency:t.currency==="INR"?"INR":"USD",name:"Blackridge Research & Consulting",description:`${t.licenseName} Subscription`,image:"https://admin.blackridgeresearch.com/_astro/BlackridgeLogoDark.oN9RCCd__Z21cFlN.svg",order_id:localStorage.getItem("orderId"),handler:function(e){console.log("Payment success",e),localStorage.setItem("paymentResponse",JSON.stringify(e)),m()},prefill:{name:document.getElementById("full-name").value,email:document.getElementById("email").value,contact:document.getElementById("phone").value},notes:{license_type:t.licenseType,addons:t.addons.map(e=>e.title).join(", "),projectId:localStorage.getItem("industrynid")},theme:{color:"#3399cc"}},g=new Razorpay(o);g.on("payment.failed",function(e){console.log("Payment failed",e),localStorage.setItem("paymentResponse",JSON.stringify(e)),m()}),document.getElementById("rzp-button1").onclick=function(e){const n=document.getElementById("checkout-form");if(!n.checkValidity()){n.reportValidity();return}const r=new FormData;r.append("name",document.getElementById("full-name").value),r.append("email",document.getElementById("email").value),r.append("phone",document.getElementById("phone").value),r.append("amount",i.toString()),r.append("currency",t.currency==="INR"?"INR":"USD"),r.append("notes_key_1",""),r.append("notes_key_2",""),r.append("project_nid",localStorage.getItem("industrynid")),r.append("packageSelected",t.licenseName),r.append("addonsSelected",t.addons.map(a=>a.title).join(", ")),fetch("https://adminapi.blackridgeresearch.com/create-order",{method:"POST",body:r}).then(a=>a.json()).then(a=>{console.log("res.json() data",JSON.stringify(a)),localStorage.setItem("orderId",a.data.id),o.prefill={name:document.getElementById("full-name").value,email:document.getElementById("email").value,contact:document.getElementById("phone").value},o.order_id=localStorage.getItem("orderId");var s=new Razorpay(o);s.open()}),e.preventDefault()};function c(e){return{USD:"$",EUR:"€",GBP:"£",INR:"₹"}[e]||"$"}function d(e,n){const a={USD:.012,EUR:.011,GBP:.0095,INR:1}[n]||1;return(parseFloat(e)*a).toFixed(2)}function m(){let e=JSON.parse(localStorage.getItem("paymentResponse"));const n=new FormData;e?.razorpay_order_id&&(n.append("paid_amount",o.amount),n.append("order_id",e?.razorpay_order_id),e?.razorpay_payment_id&&(n.append("payment_id",e?.razorpay_payment_id),n.append("payment_status","SUCCESS")),e?.razorpay_signature&&n.append("signature",e?.razorpay_signature),e?.error?.code&&(n.append("error_code",e?.error?.code),n.append("error_description",e?.error?.description),n.append("error_reason",e?.error?.reason),n.append("error_source",e?.error?.source),n.append("error_step",e?.error?.step),n.append("payment_status","FAILED")),fetch("https://adminapi.blackridgeresearch.com/update-paymentstatus",{method:"POST",body:n}).then(r=>r.json()).then(r=>{localStorage.removeItem("industrynid"),localStorage.removeItem("orderId"),localStorage.removeItem("paymentResponse");const s=window.location.pathname.replace(/\/subscribe\/.*$/,"");window.location.href=s}))}});
